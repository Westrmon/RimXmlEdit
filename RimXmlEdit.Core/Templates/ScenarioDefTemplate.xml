<?xml version="1.0" encoding="utf-8"?>
<Defs xmlns:meta="RimXmlEdit.Template"
    meta:defType="ScenarioDef">

    <!-- ========================= -->
    <!--        过滤器定义         -->
    <!-- ========================= -->
    <meta:FilterDefs>
        <meta:Filter Name="IsCrashlanded" Desc="是否为坠毁着陆（经典开局）" />
        <meta:Filter Name="IsTribeStart" Desc="是否为部落开局（科技低，人数多）" />
        <meta:Filter Name="IsNakedBrutality" Desc="是否为赤裸蛮荒开局（单人裸体地狱开局）" />
        <meta:Filter Name="HasStartingPawns" Desc="是否包含起始殖民者" />
        <meta:Filter Name="HasStartingItems" Desc="是否包含起始物品" />
        <meta:Filter Name="IsCustomScenario" Desc="是否为自定义场景" />
    </meta:FilterDefs>


    <!-- ================================================ -->
    <!--                 ScenarioDef 模板                 -->
    <!-- ================================================ -->
    <ScenarioDef meta:Name="CustomScenarioTemplate"
        meta:Desc="自定义场景模板，可根据过滤器动态切换开局类型和配置。">

        <!-- 基础信息 -->
        <defName>Custom_Scenario</defName>
        <label>Custom Scenario</label>
        <description>这是一个可通过模板系统生成的场景定义示例。</description>
        <summary>场景摘要文本。</summary>

        <!-- 场景类与类别 -->
        <scenarioClass>Scenario</scenarioClass>
        <category meta:If="IsCustomScenario">Custom</category>
        <category meta:Unless="IsCustomScenario">Adventure</category>

        <!-- ============= -->
        <!--   起始条件    -->
        <!-- ============= -->
        <playerFaction meta:If="IsCrashlanded">NewArrivals</playerFaction>
        <playerFaction meta:If="IsTribeStart">Tribe</playerFaction>
        <playerFaction meta:If="IsNakedBrutality">NewArrivals</playerFaction>

        <mapGenerator>MapGeneratorDef_Default</mapGenerator>

        <forcedWeather meta:If="IsNakedBrutality">DryThunderstorm</forcedWeather>

        <disallowedBuildings>
            <li meta:If="IsTribeStart">Autodoor</li>
            <li meta:If="IsNakedBrutality">Turret_MiniTurret</li>
        </disallowedBuildings>

        <!-- ============================= -->
        <!-- 起始物品与殖民者（动态控制） -->
        <!-- ============================= -->

        <!-- 起始物品 -->
        <startingItems meta:If="HasStartingItems">
            <li>
                <thingDef>MealSimple</thingDef>
                <count>30</count>
            </li>
            <li meta:If="IsCrashlanded">
                <thingDef>MedicineIndustrial</thingDef>
                <count>10</count>
            </li>
            <li meta:If="IsTribeStart">
                <thingDef>Pemmican</thingDef>
                <count>50</count>
            </li>
        </startingItems>

        <!-- 起始研究 -->
        <startingResearch>
            <li meta:If="IsCrashlanded">ComplexClothing</li>
            <li meta:If="IsTribeStart">Stonecutting</li>
        </startingResearch>

        <!-- 起始殖民者数量 -->
        <startingPawnCount meta:If="IsCrashlanded">3</startingPawnCount>
        <startingPawnCount meta:If="IsTribeStart">5</startingPawnCount>
        <startingPawnCount meta:If="IsNakedBrutality">1</startingPawnCount>

        <!-- 起始殖民者具体设置 -->
        <startingPawns meta:If="HasStartingPawns">
            <li>
                <pawnKind>Colonist</pawnKind>
                <nameType>Full</nameType>
            </li>
        </startingPawns>

        <!-- 是否可修改起始殖民者 -->
        <canChangeStartingPawns meta:If="IsNakedBrutality">false</canChangeStartingPawns>
        <canChangeStartingPawns meta:Unless="IsNakedBrutality">true</canChangeStartingPawns>

        <!-- ================== -->
        <!--     特殊规则       -->
        <!-- ================== -->

        <!-- 场景部分（复杂规则） -->
        <parts>
            <li Class="ScenPart_StartInDropPods" meta:If="IsCrashlanded">
                <podsArrivalMode>InDropPods</podsArrivalMode>
            </li>
            <li Class="ScenPart_DisallowBuilding" meta:If="IsTribeStart">
                <buildingDef>Autodoor</buildingDef>
            </li>
        </parts>

        <!-- 禁止内容 -->
        <disallowed>
            <li meta:If="IsNakedBrutality">Turret_Mortar</li>
        </disallowed>

        <!-- 起始游戏条件 -->
        <gameConditions>
            <li meta:If="IsNakedBrutality">VolcanicWinter</li>
        </gameConditions>

        <!-- 起始事件 -->
        <incidents>
            <li meta:If="IsCrashlanded">Crash</li>
            <li meta:If="IsTribeStart">RitualOpportunity</li>
        </incidents>

        <!-- ============================= -->
        <!--        地图生成限制           -->
        <!-- ============================= -->

        <allowedBiomes meta:If="IsCrashlanded">
            <li>TemperateForest</li>
            <li>BorealForest</li>
        </allowedBiomes>

        <disallowedBiomes meta:If="IsNakedBrutality">
            <li>SeaIce</li>
        </disallowedBiomes>

        <minMaxStartingColonists>
            <min meta:If="IsNakedBrutality">1</min>
            <min meta:Unless="IsNakedBrutality">2</min>
            <max meta:If="IsTribeStart">6</max>
            <max meta:Unless="IsTribeStart">4</max>
        </minMaxStartingColonists>

    </ScenarioDef>

</Defs>