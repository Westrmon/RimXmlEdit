<?xml version="1.0" encoding="utf-8"?>
<Defs xmlns:meta="RimXmlEdit.Template"
    meta:defType="WeatherDef">

    <!-- ========================= -->
    <!--        过滤器定义         -->
    <!-- ========================= -->
    <meta:FilterDefs>
        <meta:Filter Name="IsRainyWeather" Desc="是否为雨天（带降雨、湿度提升）" />
        <meta:Filter Name="IsSnowWeather" Desc="是否为雪天（带积雪、低温）" />
        <meta:Filter Name="IsFoggyWeather" Desc="是否为雾天（视野降低、光照弱）" />
        <meta:Filter Name="IsDangerousWeather" Desc="是否为危险天气（闪电、酸雨、致命风暴等）" />
        <meta:Filter Name="AffectsMovement" Desc="是否影响移动速度" />
        <meta:Filter Name="AffectsAccuracy" Desc="是否影响命中精度" />
    </meta:FilterDefs>


    <!-- ================================================ -->
    <!--              WeatherDef 模板定义                 -->
    <!-- ================================================ -->
    <WeatherDef meta:Name="CustomWeatherTemplate"
        meta:Desc="可根据过滤器动态调整视觉效果、环境影响、降雨或降雪、特殊天气事件等的模板。">

        <!-- 基础信息 -->
        <defName>CustomWeather</defName>
        <label>Custom Weather</label>
        <description>这是一个使用模板系统生成的示例天气定义。</description>

        <!-- ========================= -->
        <!--   通用天气数值效果       -->
        <!-- ========================= -->

        <!-- 风速影响 -->
        <windSpeedFactor meta:If="IsRainyWeather">1.3</windSpeedFactor>
        <windSpeedFactor meta:If="IsSnowWeather">1.1</windSpeedFactor>
        <windSpeedFactor meta:If="IsDangerousWeather">2.5</windSpeedFactor>
        <windSpeedFactor meta:Unless="IsRainyWeather|IsSnowWeather|IsDangerousWeather">1.0</windSpeedFactor>

        <!-- 移动速度 -->
        <moveSpeedMultiplier meta:If="AffectsMovement">0.8</moveSpeedMultiplier>
        <moveSpeedMultiplier meta:Unless="AffectsMovement">1.0</moveSpeedMultiplier>

        <!-- 命中精度 -->
        <accuracyMultiplier meta:If="AffectsAccuracy">0.75</accuracyMultiplier>
        <accuracyMultiplier meta:Unless="AffectsAccuracy">1.0</accuracyMultiplier>

        <!-- 降雨或降雪率 -->
        <rainfallRate meta:If="IsRainyWeather">1.0</rainfallRate>
        <rainfallRate meta:If="IsSnowWeather">0.6</rainfallRate>
        <rainfallRate meta:Unless="IsRainyWeather|IsSnowWeather">0.0</rainfallRate>

        <!-- ========================= -->
        <!--         视觉效果          -->
        <!-- ========================= -->

        <skyColors>
            <day>RGBA(0.7, 0.7, 0.8, 1.0)</day>
            <night>RGBA(0.2, 0.2, 0.3, 1.0)</night>
        </skyColors>

        <fogColors meta:If="IsFoggyWeather">
            <day>RGBA(0.9, 0.9, 0.9, 0.7)</day>
            <night>RGBA(0.6, 0.6, 0.6, 0.5)</night>
        </fogColors>

        <screenRainbowColor meta:If="IsRainyWeather">RGBA(1.0, 0.7, 0.9, 1.0)</screenRainbowColor>

        <overlayClasses>
            <li meta:If="IsRainyWeather">WeatherOverlay_Rain</li>
            <li meta:If="IsSnowWeather">WeatherOverlay_Snow</li>
            <li meta:If="IsFoggyWeather">WeatherOverlay_Fog</li>
            <li meta:If="IsDangerousWeather">WeatherOverlay_Extreme</li>
        </overlayClasses>

        <!-- ========================= -->
        <!--        环境影响           -->
        <!-- ========================= -->

        <temperatureRange>
            <min meta:If="IsSnowWeather">-30</min>
            <min meta:If="IsRainyWeather">5</min>
            <min meta:Unless="IsSnowWeather|IsRainyWeather">10</min>

            <max meta:If="IsSnowWeather">0</max>
            <max meta:If="IsRainyWeather">25</max>
            <max meta:Unless="IsSnowWeather|IsRainyWeather">35</max>
        </temperatureRange>

        <repeatable>true</repeatable>

        <favorability meta:If="IsDangerousWeather">-2</favorability>
        <favorability meta:If="IsFoggyWeather">0</favorability>
        <favorability meta:If="IsRainyWeather">1</favorability>
        <favorability meta:If="IsSnowWeather">0</favorability>
        <favorability meta:Unless="IsRainyWeather|IsSnowWeather|IsFoggyWeather|IsDangerousWeather">2</favorability>

        <isBad meta:If="IsDangerousWeather">true</isBad>
        <isBad meta:Unless="IsDangerousWeather">false</isBad>

        <!-- ========================= -->
        <!--       声音与粒子效果      -->
        <!-- ========================= -->

        <soundAmbience>
            <soundDef meta:If="IsRainyWeather">Ambient_Rain</soundDef>
            <soundDef meta:If="IsSnowWeather">Ambient_Snow</soundDef>
            <soundDef meta:If="IsFoggyWeather">Ambient_Fog</soundDef>
            <soundDef meta:If="IsDangerousWeather">Ambient_Storm</soundDef>
            <soundDef meta:Unless="IsRainyWeather|IsSnowWeather|IsFoggyWeather|IsDangerousWeather">
                Ambient_Clear</soundDef>
        </soundAmbience>

        <soundAmbienceSecondary meta:If="IsDangerousWeather">
            <soundDef>Ambient_Thunder</soundDef>
        </soundAmbienceSecondary>

        <windTurbulence meta:If="IsDangerousWeather">0.9</windTurbulence>
        <windTurbulence meta:If="IsRainyWeather">0.5</windTurbulence>
        <windTurbulence meta:Unless="IsRainyWeather|IsDangerousWeather">0.2</windTurbulence>

        <!-- ========================= -->
        <!--        特殊事件与覆盖     -->
        <!-- ========================= -->

        <worldOverlays>
            <li meta:If="IsSnowWeather">WorldOverlay_Snow</li>
            <li meta:If="IsDangerousWeather">WorldOverlay_Storm</li>
        </worldOverlays>

        <screenOverlays>
            <li meta:If="IsFoggyWeather">ScreenOverlay_Fog</li>
            <li meta:If="IsRainyWeather">ScreenOverlay_RainDrops</li>
        </screenOverlays>

        <weatherEventClasses>
            <li meta:If="IsDangerousWeather">WeatherEvent_LightningStrike</li>
            <li meta:If="IsRainyWeather">WeatherEvent_Rain</li>
        </weatherEventClasses>

    </WeatherDef>

</Defs>